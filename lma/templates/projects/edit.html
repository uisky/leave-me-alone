{% set menu_current = 'edit' %}
{% extends 'project.html' %}



{% block content %}
<h1>Свойства проекта</h1>

{% if project.user_id == current_user.id %}
<form method="post" action="{{ url_for('.project_edit', project_id=project.id) }}" class="form-horizontal">
    {{ form.csrf_token }}
    <div class="form-group">
        <label class="control-label col-sm-2">Название</label>
        <div class="col-sm-10">
            {{ form.name(class='form-control') }}
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-10 col-sm-offset-2">
            <label>
                {{ form.has_sprints() }}
                Использовать спринты
            </label>
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-success">
                <span class="glyphicon glyphicon-ok"></span> Сохранить
            </button>
            <button type="button" class="btn btn-danger" id="btn-delete">
                <span class="glyphicon glyphicon-ok"></span> Удалить
            </button>
        </div>
    </div>
</form>

<form method="post" action="{{ url_for('.project_delete', project_id=project.id) }}" id="form-delete">
</form>


<div class="row">
    <div class="col-sm-offset-2 col-sm-10">
        <form method="post" action="{{ url_for('.set_type', project_id=project.id) }}">
        {% if project.type == 'tree' %}
            <input type="hidden" name="type" value="list">
            <button type="submit" class="btn btn-danger">
                Превратить в простой список задач
            </button>
        </form>
        {% elif project.type == 'list' %}
            <input type="hidden" name="type" value="tree">
            <button type="submit" class="btn btn-danger">
                Превратить дерево задач
            </button>
        {% endif %}
        </form>
    </div>
</div>




{% if project.has_sprints %}
    <h2>Спринты</h2>
    {% if sprints %}
        <table class="table table-bordered">
        <thead>
        <tr>
            <th style="width:60%">Название</th>
            <th>Сроки</th>
            <th></th>
        </tr>
        </thead>
        {% for sprint in sprints %}
        <tr data-id="{{ sprint.id }}">
            <td><a href="{{ url_for('.sprint_edit', project_id=project.id, sprint_id=sprint.id) }}">{{ sprint.name }}</a></td>
            <td>{{ sprint.start.strftime('%d.%m.%Y') }} — {{ sprint.finish.strftime('%d.%m.%Y') }}</td>
            <td>
                <button type="button" class="btn btn-xs btn-danger">
                    <i class="glyphicon glyphicon-remove"></i>
                </button>
            </td>
        </tr>
        {% endfor %}
        </table>
    {% else %}
        <div class="alert alert-info">В проекте ещё нет ни одного спринта.</div>
    {% endif %}
    <a href="{{ url_for('.sprint_edit', project_id=project.id) }}" class="btn btn-success">
        <i class="glyphicon glyphicon-plus-sign"></i> Добавить спринт
    </a>
{% endif %}



{% else %}
    <div class="alert alert-info">
        Вы не можете изменять свойства проекта.
    </div>
{% endif %}
{% endblock %}



{% block tail %}
<script type="text/javascript">
(function() {
    $('#btn-delete').click(function(e) {
        if(!confirm('Вы это серьёзно? Назад дороги не будет.')) return;
        $('#form-delete').submit();
    });
})();
</script>
{% endblock %}