{% extends 'base.html' %}

{% set menu = (
    {'id': 'tasks', 'url': url_for('.tasks', project_id=project.id), 'title': 'Задачи'},
    {'id': 'my', 'url': url_for('.member', project_id=project.id, member_id=current_user.id), 'title': 'Мои задачи' + g.my_tasks_count|my_tasks_count},
    {'id': 'about', 'url': url_for('.about', project_id=project.id), 'title': 'О проекте'},
    {'id': 'history', 'url': url_for('.history', project_id=project.id), 'title': 'История'},
)
%}

{% block logo %}
<div class="navbar-header">
    <a class="navbar-brand dropdown-toggle" href="/" data-toggle="dropdown">
        LMA: {{ project.name }}
        <span class="caret"></span>
    </a>
    <ul class="dropdown-menu menu-projects">
    {% if g.my_projects|length == 1 %}
        {% for prj in g.my_projects.popitem()[1] %}
            <li {%- if project and prj.id == project.id %} class="active" {%- endif -%}><a href="{{ prj.url_for() }}">
                {{- prj.name -}}
            </a></li>
        {% endfor %}
    {% else %}
        {%- for folder, projects in g.my_projects.items() %}
            <li class="folder">{{ folder.name|default('Основные') }}</li>
            {% for prj in projects %}
                <li {%- if project and prj.id == project.id %} class="active" {%- endif -%}><a href="{{ prj.url_for() }}">
                    {{- prj.name -}}
                </a></li>
            {% endfor %}
        {%- endfor -%}
    {% endif %}
        <li role="separator" class="divider"></li>
        <li><a href="/projects" title="Центр Управления Проектами"><i class="fa fa-rocket"></i> ЦУП</a></li>
    </ul>
</div>
{% endblock %}

{% block menu_main %}
<ul class="nav navbar-nav">
{%- for item in menu %}
    <li {%- if menu_current == item.id %} class="active" {%- endif -%}><a href="{{ item.url }}">{{ item.title }}</a></li>
{%- endfor -%}
</ul>
{% endblock %}